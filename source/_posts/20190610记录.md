# 0610

> 已提交刷新按钮，自动测试一版
>
> pickFlag的问题，自动测试问题

## pickFlag筛选有反射折射的模型

用两位分别表示反射和折射属性的方法不能实现只筛选反射且折射的node

node的pickFlag的值可能是00，01，10，11

| pick参数 | 能被pick到的node                     |
| -------- | ------------------------------------ |
| 不传参   | 00，01，10，11（所有node）           |
| 00       | 无                                   |
| 01       | 01，11（有折射的node）               |
| 10       | 10，11（有反射的node）               |
| 11       | 01，10，11（有反射**或**折射的node） |

但要pick反射**且**折射的node，即只选pickFlag为11的node，是不能通过pick的参数实现的。



- 用三位来控制

  增加一位表示与，在node的参数为11时，增加位 置为1，pick传参数 1XX

- 用单独的一位控制是否被筛选？每次点击会改变模型的pickFlag值



问题：

草非折射也非反射00，用pickFlag不显示双非的模型，同时也会不显示草

addNode中合并模型没设置pickFlag的值

如果不取消模型选中，只更新list：点击没反射的模型，然后筛选反射，再选中有反射的模型，正常显示后，两个模型都是选中状态的

辅助模型在筛选状态下pick不到

折射反射在合并模型后全为true



筛选场景中的node，不显示的node取消选中状态（取消了所有的选中，刷新list）

当改变模型的属性（如果被筛选，应该取消选中状态，刷新list）



改变筛选值或者改变模型属性，应该刷新list，检查是否要被刷掉，



BUG：

老版的草编辑器中打开时贴逻辑地表，不贴地表，当不显示逻辑地表重新刷草，草回到地表

但是在显示逻辑地表状态下，刷草到逻辑地表

即加载之初的状态不正确，操作过程中贴显示的地表，不贴地表

## 自动化测试崩溃问题

不是必崩

### 自动测试未完成

- 动画资源检查

### 自动测试问题汇总

1. 中文路径不测试的问题
2. 崩溃，跑资源崩溃出现频数高
3. 引擎出现运行错误，中止程序

### 自动测试优化

1. 有无控制截图数量的需求，若无，入口文件只保留控制是否截图
2. 明确打印的内容，方便QA查找问题
3. 是否保留分块检查场景资源的功能
4. 

# 0611

> 提交筛选

## 中文

现象：

1. 在自动测试例子时用getPath等得到的是正确的中文
2. 在脚本中写字符串，打印。中文乱码，\ \ 后面的中文不显示
3. 字符串中一个中文所占字节数为2，大于127
4. 用enumFolder打印出的正常，所占字节数为3

猜测：

文本中的字符串为UCS2编码，引擎enum中处理UTF8编码

打印和处理没问题的是UTF8编码

![1560233036314](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\1560233036314.png)

UTF8标准

10XX XXXX：128-191，非打头的字节



能够处理的为UTF-8

而这里是GB2312

问题解决：将文件保存成UTF-8的格式

## scene在new的时候报错

骨骼参数报错

未解决







# 0612

特效0605号的引擎跑完没问题，用1313和1410有问题



待办：

场景编辑器图片不要拉伸

区域刷草

天光上下键

跑脚本发现泄露问题



### 自动测试问题



#### 1参数骨骼报错

kog_diy_watch.skl

kog_diy_watch_emo01.san

kog_diy_watch_emo02.san

#### 2特效等不同 问题汇总

1. A1313和B140跑对比
2. 1313和1313，只有D__client\98_kog_yucun_01.bmp场景有问题
3. 140同版本，结果同上

综上，模型亮度为不同版本引擎问题，非脚本问题

## 布料异常问题 

http://fancy3d.wt.fancyguo.com/task/show/14874
#14874 【狂暴2】【布料】狂暴2布料异常问题

关闭物理，或者讲暂时地取消模型蒙皮与物理之间的关系

关闭不一定是一直关闭，可以在出问题的地方关闭物理，而这个时间段也不需要展示物理的效果

思维方式要改变，想问题要分更细的步骤，一小步一小步尝试解决问题

# 0613

资源测试问题

- 两个特效问题：待查
- 模型资源检查：脚本没有问题，应查引擎问题

- 场景问题：正在查

场景问题：

dr_cha_juese.sen

单独跑场景截图相同





## 自动化问题

### 资源测试问题

kog_cbhw_01.sen
kog_yucun_01.sen

两个场景只要有一个出现，对之后的场景就有影响

解决：草改变随机种子的原因

### 优化和问题

- 只跑场景，多一张，第3帧黑屏
- 单独测试一个资源，完善测试模型的摄像机

### 需求

在测试某个资源发生引擎崩溃后，仍然能够继续测试后面的资源

### 隐患

- 出现一次随机种子改变，对之后测试的资源都有影响

  如果资源中有用到随机，比如特效，拿到的随机值不一样，两次的截图也会不同

- 

### 考虑录制

现在的改变有无影响录制





## 区域刷草的套索

改成顺序加点的方式



# 0614

> 查自动化的问题
>
> 区域草刷的套索顺序加点

## 草刷

面向对象的方式地表上画线

1. 不实时计算：已经确定的线
2. 预览的黄线，需要实时计算，需要**传入颜色参数**

如果按照线的终点的方向分段，越陡峭，每次画的线越长

从效果上，陡峭每段线不变才好

希望在new期间调用计算点的函数

## 自动测试优化

- 在出现崩溃后能继续测试资源

方案：定

**问题：**

1. 有无控制截图数量的需求，如果没有，默认给每种资源测多少张
2. 明确打印的内容，方便QA查找问题
3. 是否保留分块检查场景资源的功能
4. 修改成一个一个资源运行的方式，截图怎么组织起来，文件夹命名，截图命名，截图排序
5. 单独测试资源的例子



（手动没报错，自动测试例子报错，可能是操作步骤中出现的）

最后记得保留svn上摄像机和分块的代码











## 发现的BUG

```lua
local function absorbMaterial(x, y)
	local sen = getEditingScene{}
	local result = sen:pick(_rd:buildRay(x, y), 8)
	if result == nil or result.node.mesh == nil then return end

	local subMeshes = result.node.mesh:getSubMesh(result.name)
	if subMeshes then
		selectMaterialFile{materialName = subMeshes.material.resname}
	else
		selectMaterialFile{materialName = result.node.mesh.material.resname}
	end
end
```



# 0615

自动测试小改

单独跑一个资源的脚本

- 功能上：用两版引擎同时运行？用

- 与测一个资源的脚本放在一起



测试：

输入：

1. 工作路径
2. 控制是否截图/截图数量

过程：

测试



### 看代码

1. TerrainLine

   将areaLines面向对象，尝试用class

2. 自动测试

   面向

3. 新材质代码

- 自动测试配置文件，中间加个资源名称的表：遇到的问题是，多个项目
- 自动测试入口可以搞成写一个资源名，手动测一个，写成一个表，自动测一堆

自动测试修改

问题：

1. 帧间隔`_app.runElapse`取消
2. addOrder不起作用，右键也不起作用，只有鼠标中间滑轮起作用
3. 场景摄像机最后两帧不用改

两个矛盾：

1. 工作路径设置需要在Auto之后，不然截图回到资源目录下；所以资源的创建需要在Auto之后
2. 单独看例子不需要runElapse

总结：

沟通

表达清楚

先想清楚自己的问题，从结论说起，从主干说起

消除内心的纠结，每次提交前一番内心挣扎……浪费了不少时间

也尝试学习用文字描述清楚问题，WT下面说清楚问题和更新说明，自己写的代码把文档写好