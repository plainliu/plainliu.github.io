---
title: 20200210记录
date: 2020-02-12 14:08:20
tags:
---



# 0210

请假

# 0211

请假

# 0212

##  检查工具pipeline的整合

问题与解决方案

一、 检查特效有缓存信息

结束后把快照信息复制到`pfxtmpdata`目录，与module和res目录并列

运行时从该文件夹拷贝缓存信息到module目录下

二、 上报错误信息的实现

1. bat调用py
   - 拿svn资源
   - svn上发送错误信息的py
   - bat调用
2. 引擎调用
3. bat调用py
   - 发送信息的py在Jenkinsfile所在的文件夹下（共享库方式）

三、 并发执行任务的控制

![1581503968938](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\1581503968938.png)

尚未解决



## 云主机机器人

引擎与项目划分明确的界限

### 项目

需要做的：提供机器人自动化跑流程的模式

自动化模式打开方式：在cfg中添加一个开关参数

### 引擎

目的：一键开始机器人任务

**第一阶段**

先去程序化，不需要程序员操作，普通人工可以按照文档说明进行操作

**去掉在项目程序中的patch**，引擎不应该限制项目的使用方式

比如限制自动化模式下项目读写文件文件需要对文件名进行时间戳标记（否则多个进程读写冲突）

1. 打包

   - 处理项目资源
   - 项目cfg中加入自动跑开关
   - 使用的引擎有fakeRender功能

2. 部署一台云主机

   - 添加启动多个机器人bat
   - 设置开机任务
   - 重启测试通过

3. 提取云主机镜像

   至此，准备工作完成

4. 部署新机器

   用镜像部署多台云主机

**第二阶段**

把人工操作串起来，用bat、调用api等方式

### 目的

降低公司成本

从程序成本降低到QA成本，再从QA成本降低到机器成本

“反正QA便宜”



# 0213

## 自动化测试卡住

![1581559273309](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\1581559273309.png)



单元测试卡到了获取特效发射器接口

```lua
-- 原来这么用
local emts = pfx:getEmitters()
-- 现在是
local emts = {}
pfx:getEmitters( emts )
```

修改不通过的单元测试

注：编辑器需要修改接口使用



修改接口后，有崩溃

对于已经保存在自定义特效中的代码，有调用接口

## 整合pipeline

- 把当前的整干净

  变量等填写成实际的

  代码整洁

  逻辑清晰

- 明确未解决的问题



## 云主机备忘

1. 降低帧率
2. fakeRender使用的开关代码

## 接口用法改动

模块中使用到各接口的模块

1. 特效信息获取模块
2. 

编辑器改动

自定义特效改动

打包脚本调用的自定义特效处理工具

自定义特效中保存的代码



今天：

1. 接口改动引起的问题

   处理单元测试卡住和不通过

   资源检查工具改动（修改接口）

2. pipeline

   小范围调整并提交了当前的代码

3. 测试龙少做的功能

   job测试了以下两种情况，测试没有问题

   ```lua
   _abort(0) -- 成功
   _abort(1) -- 失败
   ```


待办：

1. 测试龙少功能
2. 出完新引擎跑自动化
3. 加屏蔽例子



# 0214

## 自动化测试结果

1. 单元测试结果

   手动跑不通过的有

2. 资源测试结果

## pipeline收拾与查资料

待考虑和优化：

1. 确认拿项目资源的账户信息
2. 完善错误信息发送
3. 调用检查工具pipeline的并发处理
4. 指定绝对路径