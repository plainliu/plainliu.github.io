---
title: 20190902记录
date: 2019-09-02 10:43:38
categories: WorkSummary
tags:
---

**待办**

添加newframe接口

编辑器的描边替换

**插入**

修改自动跑例子的测试（报错不停、13690、相同版本引擎跑俩不同）

marker排序问题（模块、测试）

# 0902

table.sort(tb, cmpfunc)

相等返回false，否则有问题

# 0903

测试移动端新一帧接口

marker排序的问题

edge

## marker

gra

table.sort() 比较函数中返回false

**记录**

gra例子中的内容会发生排序错误

- 将数据从编辑器中分出来

- 对比正确效果和错误效果的比较过程

# 0904

detail的问题，不能保存下来

将detail属性从geo上移到node上

# 0905

RDSetting的提取

分析：

RDSetting中的函数

```lua
_PostProcess:cloneData()
_PostProcess:clone(pp)
_Color:clone(color)

_G._LRDSetting

_Scene.new(filename)
_Scene:cloneSceneRDSetting(scene)
_Scene:useRDSetting(db)
_Scene:saveRDSetting(filename)

_RenderDevice:useSceneSetting(scene)
_RenderDevice:pushSceneSetting(scene)
_RenderDevice:popSceneSetting()
```



```markdown
# Edge替换计划
1. 把SceneRDSetting从lib中提出来，提成模块，修改几个编辑器中dofile方式为_require
2. 针对SceneRDSetting的功能，给模块加单元测试
3. 把SceneRDSetting中的edgeSetting替换成类
4. 添加edgeSetting的元数据，跑通结构新界面（已写好）
5. 使Editor_EdgeSetting新界面中的调整生效（可能通过扩展_rd的方法）
6. 用新detail面板更换Editor_EdgeSetting
7. 新detail面板加编辑器
8. 处理隐藏显示等


6. 加载不同场景编辑描边，并保存配置，重新加载——跑通
7. 测试并解决其他新老结构可能存在的不合之处

# Edge界面替换记录
## 1. SceneRDSetting变成模块
修改内容
- 从lib中删除postprocess相关的两个文件
- 修改dofile为 _ require（所有编辑器）
- 删除copylib中RDSetting相关文件的行为（所有编辑器，模型编辑器没有用到）
- 删除出版模块中拷贝RDSetting文件的代码

问题记录
- draw(rOrbit, gOrbit, bOrbit)方法和allconfigname历史遗留（删除）
- postprocess的new方法中关于bloomtint颜色的初始值（已确认）
- 重写postprocess的new方法已经有编辑因子的属性，与再增加一个postSetting类是否冗余（提取后处理类需要考虑）
- 编辑器中关于require方法重定义，确认编辑器出版是否用到

## 2. 对SceneRDSetting的功能，给模块加单元测试
修改内容
- 删除draw(rOrbit, gOrbit, bOrbit)方法和allconfigname内容
- 删除多出的编辑因子初始化
- 添加每个对外接口的单元测试

问题记录
- 接口对应的参数比较多（rd相关的属性），单元测试覆盖的全面性问题
- 测试接口拿到的属性，应该与谁进行比较，默认值 _ LRDSetting之后会分散地替换到每个类的构造中（先用 _ LRDSetting，提取成类之后，修改为与新建类对象的默认属性做比较）
- rd和drawboard的关系
- markMesh的作用是什么

## 3. 把SceneRDSetting中的edgeSetting替换成类
修改内容
- 检查 _ EdgeSetting类的定义并调整
- 重写SceneRDSetting（更新结构）
- detailRange应用的地方做修改，属于scene的属性，不用在RDSetting中修改
- 扩展rd:use方法
- 对外接口干掉PostProcess:cloneData()、scene:cloneSceneRDSetting()、PostProcess:clone(pp)
- 后处理恢复默认的功能用到全局的变量（用局部后处理设置类的对象代替）

问题记录
- 类对象的初始值（按照 _ LRDSetting中的值设置）
- detailRange为sen的属性，为什么在RDSetting中保存一份，而不是sen存取
- skybox属于sen的属性，范围和缩放在天空盒起效的情况下成为多存的一份配置
- 后处理配置从一个后处理对象变成自定义类，需要在切换场景时后处理对象的应用做修改
- mtlEnvironmentTexture的应用过程没整明白
- orbit的保存和应用过程（在场景编辑器中干掉）
- shadow相关的属性文档中比编辑器中多
- postprocess的设置，last值
- 环境贴图眼睛预览（之后去掉编辑器中的设置）
- shadowSetting中的shadowLight用场景gra的光设置（不用设置）
- 需要验证rd使用的颜色对象与'='设置的颜色对象是否为同一个，编辑rd的bloomTint1，setting的bloomTint1是否改变
- skyBoxSetting.selected作用
- PostProcess:clone(pp)在哪里使用
- detailrange的使用
- rd的后处理中颜色对象直接改rgb没有变化，赋值才有变化

待办
- 目前SceneRDSetting结构大体定下了，打开场景，点左侧场景选项报错
- 点击后处理报错、更换后处理应用方式，全局postProcess
- 确认干掉的方法是否有用
- 详细捋一遍有关默认数据和赋值相关的地方，确认表的复制和赋值没问题
- 编辑器中加载修改保存各个setting相关内容测试（描边和虚光ok）
- 保存markMesh

## 4. 添加edgeSetting的元数据，跑通结构新界面（已写好）
修改内容
- 检查描边类的元数据模块和编辑面板模块
- 把editor模块例子中用到的SceneRDSetting.lua替换为模块（从svn上删除）
- 将edgesetting类相关内容移出来单独成为一个模块
- 用detail结构替换

问题记录
- 元数据作为一个单独的文件、或者直接在edgesetting类定义模块中

## 5. 使Editor_EdgeSetting新界面中的调整生效（可能通过扩展rd的方法）
修改内容
- rd应用edgesetting对象的方法(rd:useEdgeSetting(object))

问题记录
- 应用之后，修改edgesetting过程中让rd的状态同时生效的方法

**待办**
- 用元数据修改状态标记方式代替每一帧use（完成）

## 6. 用新detail面板更换Editor_EdgeSetting
修改内容
- 写detail的例子

问题记录
- setObject(nil)面板点关闭无响应，另面板是否需要另加设置隐藏显示的函数（不需要、已删除关闭按钮）

## 7. 新detail面板加编辑器
修改内容
- 删除右边UI相关的代码（ui1.lua, edge.lua）
- 隐藏所有界面：删除edge相关
- 显示界面设置：删除edge相关
- 新界面的位置和适配调整
- 描边面板的位置（定位x和y，w和h与窗口的适配，右侧下面FPS的显示等）
- 删除中英文和提示
- 把面板相关定义放到edge外面

问题记录
- 添加DetailEditor界面变全黑（在viwer中重定义app函数，即在luaui等之前）
- 加进去后界面上没有显示、点关闭没有反应
- 加进去后：点击属性没有显示（已解决）
- 点击预览没有隐藏（已解决）
- 中英文FUI上的没有变化
- inputslider的显示位数限制
- detail面板定义与使用的方法（先放viewer、向单独的场景编辑器模块过渡）

## 8.其他
问题记录
- 后处理的开关
- require出版问题

待办
- 面板的定义位置、处理显示和隐藏
- 后处理、编辑因子生效
- markMesh
- 修改和补全单元测试
```



## edge

颜色数值的初始值不对，少两位

用setting的版本，删除第一版代码

# 0906

确认detail的问题

修改方法

