---
title: 20191230记录
date: 2019-12-30 10:17:05
tags:
---



# 1230

检查

1. 文件名匹配问题
2. 角色-cha/char
3. 采集物 D=0，P为空

Q：

1. 表格中采集物的P值标准为0，D值标准为空，确认一下采集物（obj）的标准
2. 角色检查的第一级文件夹名称是cha和char哪一个呢
3. 角色的文件名，先按照表格里的命名做的功能，kog目前命名现状同步后，再做修改



TODO

- [x] job配置
- [x] 修改模型检查配置
- [x] 增加模型测试资源
- [x] 加单元测试
- [x] 特效检查移动到193
- [ ] 动画检查（到193、联调正式环境）
- [ ] 模型检查到193
- [ ] 模型检查log添加和本地检查结果
- [x] 特效检查-attach模式
- [ ] 特效检查对nil的处理



测试-tool模式job断开，是否继续测试

开发环境：



测试环境的特效检查有一次报错

- Check_Pfx.lua Line94
- log c == nil



# 1231

出检查动画的引擎

把检查动画的job搞成pipeline



## 检查动画改成pipeline

流程

- 输入

  1. dev/test/prod
  2. module version
  3. project version
  4. project svn

- get label/module svn/co dir

  由输入决定：

  - 运行机器
  - co地址
  - 模块的svn地址

- checksvn

- bat运行

拆分

- 把单个任务重写成pipeline
  1. 改变参数
  2. 定义lable
  3. 
- 把开发测试以及正式环境的任务合并成pipeline



```grovy
checkout([
	$class: 'SubversionSCM',
	additionalCredentials: [],
	excludedCommitMessages: '',
	excludedRegions: '',
	excludedRevprop: '',
	excludedUsers: '',
	filterChangelog: false,
	ignoreDirPropChanges: false,
	includedRegions: '',
	locations: [],
	quietOperation: true,
	workspaceUpdater:[$class: 'UpdateUpdater']
	]
)
```



创建检查动画分支

给正式环境





docker

kinbenetes

![1577785209829](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\1577785209829.png)

https://docs.docker.com/docker-for-windows/troubleshoot/#virtualization-must-be-enabled

![1577788145175](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\1577788145175.png)





# 0102

## 提高特效检查速度

方案：

1. 增量检查
2. 子进程并行
3. 一次子进程检查多个特效

计划：

一、进行统计

统计时间消耗，每个进程时间消耗和进程实际运行的时间消耗

二、确定优化方案

三、优化



svn改动

1. 增加193结点
2. 提交percentage拼写问题、提交打印
3. 提交特效标准修改，合并到主干，合并到正式分支
4. 开动画检查正式使用的分支
5. 提交



pipeline

同一个任务co一份资源到指定地址，如果启动两次，@tmp 对于绝对路径是否同样起效



**增量检查**

特效及依赖文件

这个功能不需要缓存，只需要有快照，所以“变动”只需要增/改动，不需要‘删除’项目

存储的信息是所有特效的原始资源信息

工具的任务：

- 如果未改变，从存储信息中拿
- 如果有改动，重新跑一遍，拿数据



```lua
-- if snapshot
-- if fob changed
-- enum pfxs
for pfx:
	if pfxchanged
    if pfxres changed
```



特效增量做完之后准备把每天测试的job做成pipeline，从编译到测试，一个pipeline

# 0103

## 增量检查特效

步骤：

1. 拿到所有特效

2. 是否有快照和缓存信息

3. 检查引擎是否变动、工具本身是否有变动

4. 获取特效变动列表（期间生成新的快照信息和特效信息表）

   - pfx本身是否有变化

   - 依赖的文件列表是否有变化

     对比快照中的MD5，无则检查

5. 播放特效

6. 保存新数据

   - 保存MD5（key不带文件路径，信息中保存文件路径？）
   - 保存检查结果（key不带文件路径，filename带路径）

7. 数据分析

8. 发送



加单元测试

1. 加检查单个特效的单元测试
2. 加对于不同情况的文件改动的测试
   - 引擎变化
   - 工具变化（？）
   - 特效本身变化
   - 特效依赖的次级资源变化



注：

对于没变化的特效，先检查是否有缓存的检查结果

没有则重新跑



# 0104

单元测试！

1. 获取资源列表
2. 正确分辨文件是否变化
3. 输入文件列表，输出需要重新检查的列表



Q

1. 文件名（key）

   不带路径，获取得到的资源列表是已有资源带路径的文件名

2. 缺失资源的文件没有检查出来

3. 

