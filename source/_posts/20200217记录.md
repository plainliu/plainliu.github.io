---
title: 20200217记录
date: 2020-02-17 10:53:51
tags:
---



# 0217

## 检查工具pipeline

1. ~~utf-8格式问题~~

   修改成GBK编码

2. ~~定义jobinfo变量的方式，全局定义or在{}里面定义~~

   {}里面的定义需要包含在 steps的script中，这样作用域只在该script块内

3. **并发job的处理**

4. ~~agent none、master开头~~

   使用`agent none`测试通过

5. ~~检查过程崩溃，是否进入failure过程~~

   会进入failure

6. ~~发送错误信息完善~~

7. ~~确认拿项目资源的权限~~

   当前账户有权限

8. 绝对路径（视并发的处理情况再定）

9. 远程触发的url

## 自动化集成module pipeline

1. 测试失败添加提交人信息
2. 用abort(1)



# 0218

## 并发job的方案

1. 不并发
2. 查表指定路径
3. 主job调用子job



之后需要完善：

1. 检查特效的中间文件存储位置调整
2. 触发的链接生成

## 自动化集成模块

1. 完善失败的信息
2. 用abort(1)
3. 测试每日检查的单元测试，目前是不是job会失败（）

**问题记录**

变量pass = false，预期执行`_abort(1)`，`%errorlevel%`拿到的是1

```lua
--------------------------------------
-- 一、errorlevel = 0
if pass == false then
	print(1234)
	_abort(1)
end
_abort()

--------------------------------------
-- 二、errorlevel = 1
if pass then
	_abort(0)
else
	_abort(1)
end

--------------------------------------
-- 三、errorlevel = 1
if pass == false then
	_abort(1)
end
```

```bat
fancy-dev.exe
echo %errorlevel%
pause
```

龙少：**abort不是立即返回，只是发了一个消息**



打包脚本需要做同样的处理



今日：

0. 并发检查工具pipeline暂未定下好的解决方式
1. 小闲同志在测试不通过的情况下发送的信息优化了下
2. 把单元测试job不通过的通知方式换成了龙少做的功能
3. 修改abort后影响每日自动化测试的衔接（单元测试不通过导致job变红，影响连接sample例子测试等，所以把每日单元测试修改成了pipeline）



记录：

pipeline的bat执行的路径不能是中文，名称是中文，用英文的指定路径就可以执行了

# 0219

1. 不并发
2. 查表指定路径
3. 主job调用子job


pepeline{}这样的只支持缺省的并发方式，不支持设置这些属性
http://www.mikesay.com/2019/07/08/jenkins-concurrent-builds/


整理从2月3号的任务

- 模块持续集成
  - 添加fancy-module集成的pipeline
  - 用龙少的_abort(1)做检查失败的连接
- 协助王子整云服务拉起失败的问题
  - 创建新镜像时设置的密码与镜像中保存的密码不一致
  - 创建镜像时部署机器的密码与计划任务设置的密码不一致
  - 修改项目资源后，重新部署机器
- 检查工具整理成pipeline
  - 整合特效、模型、动画、文件的检查job
  - pipeline中添加上报错误的过程
- 处理自动化测试出现的问题
  - 自动测试因引擎接口修改导致的问题，单元测试卡住、资源测试报错
  - 单元测试不通过的问题
- 给





2.3

请假

2.4-2.5

1. 添加fancy-module集成的pipeline
2. 协助王子整云服务拉起失败的问题
    - 创建新镜像时设置的密码与镜像中保存的密码不一致
    - 修改项目资源后，重新部署机器

2.6-2.7

1. 整合检查工具pipeline
   - 检查模型的pipeline测试通过
   - 在内部定义函数的方式查label和module表
2. 云主机
   创建镜像时部署机器的密码与计划任务设置的密码不一致


2.10-2.11

请假

2.12-2.14

1. 整合检查工具pipeline
  - 整合四个检查工具
  - 添加上报错误过程
  - 修改特效的缓存信息处理方式（保存到workspace）
2. 自动化测试
  - 自动测试因引擎接口修改导致的问题，单元测试卡住、资源测试报错
  - 单元测试不通过的问题，资源测试的问题
3. 给BCP模拟鼠标按键的引擎和例子

2.17-2.19

1. 检查工具pipeline
   - 修改细节部分（编码格式、参数等）
   - 寻找并发job的解决方案
2. module集成优化
   - 优化输出
   - 用龙少的_abort(1)做检查失败的连接



并发方案：

1. 限制不影响日常使用的并发数量（a，eg：10）

   - 一次检查的时间除特效外，时间都在几分钟内

   - 防止出现调用方出现bug一次调用成百上千
   - 防止一台机器上workspace数量太多

2. 限制并发间隔

   eg：每20秒允许一次并发

   - 间接控制workspace数量（当后续的任务开始运行时，比较早的任务已经结束了，可以重复利用workspace）

3. 





# 0220

问题：

合并的pipeline是否需要有开发环境、测试环境、正式环境区分



我想着应该区分开：
原因
1. Jenkinsfile中的内容已经开始变多，逻辑不单一
2. 新功能加入后需要先测试添加到Jenkins后链接正常，再使用
3. 第一次加进Jenkinsfile（开发状态）的内容不应该影响正式环境



并发解决方案：

1. 限制total个数（eg：20）

   防止出现调用方出现bug一次调用成百上千，全部进入执行状态

2. 单台机器上靠 # of exe 防止workspace控制



1. 把特效缓存信息保存到16上
2. 

记录：

1. 
2. 权限：拿狂暴分支的权限



robocopy

