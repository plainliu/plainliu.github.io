---
title: 20191223记录
date: 2019-12-23 10:51:27
tags:
---

- [ ] 加入meshP检查
- [ ] san动画检查工具

# 1223

## 单个模型P的检查

1. 检查可优化的地方

2. 获取特效信息的进程

   - 单元测试

   - 删除播放过程中获取模型最大P的过程
   - 添加单个模型最大P的信息
   - （原来meshP的数值换成单个模型的）
   - （贴图信息）

3. 数据分析进程

   - 增加对单个模型P的分析

4. 环境调整

   开发环境联调

5. 对接WP

   - 近期结构优化

     range内容显示有小幅度变化，比如`5-5D`显示为`5D`

   - **client/res/pfx**目录需要调整为**client/res**目录

     特效有使用res目录下其他文件夹中的模型文件

     ```plain
     http://10.1.1.13/fancy-dev-11/packagetool-test-forwp/client/res/pfx
     变成
     http://10.1.1.13/fancy-dev-11/packagetool-test-forwp/client/res
     ```

   - 增加了单个模型最大P的字段

     1. 总览、高低端机各项检查中增加”**单个模型P值**“
     2. 详细信息中增加字段maxMeshP（显示到模型P[meshP]的后面）

   - 中文进度信息

     修改进度信息为中文进行测试

   - 测试环境、开发环境、正式环境

6. 



**获取特效模型信息**

1. 模型整体信息

2. 子模型信息

3. 模型发射器个数与检查的模型数目是否一致

   resname不空且不是空字符串的模型发射器

   ```lua
   -- 模型发射器没有设置模型
   pfx\cha\kog_cha_nan_dd_w_skill02_hcy_canying.pfx
   pfx\cha\kog_zlq_cha_nan_td_skill01_03.pfx
   pfx\cha\kog_zlq_huan_fangun_yz.pfx
   pfx\cha\kog_zlq_jita_fangun_yz.pfx
   pfx\cha\kog_zy_cha_nan_td_2_skill01_02_03.pfx
   pfx\cha\kog_zy_cha_nan_td_2_skill01_03_03.pfx
   pfx\cha\kog_zy_cha_nan_td_atc03_canying_b6.pfx
   pfx\cha\kog_zy_cha_nan_td_q_skill01_canying.pfx
   pfx\cha\kog_zy_cha_nan_td_q_skill02_canying.pfx
   pfx\cha\kog_zy_cha_nan_td_skill01_03_b6_pj01.pfx
   -- userdefined
   pfx\mon\kog_zlq_npc_nvjunguan_001_skill01_01.pfx
   
   -- 未看
   pfx\cha\kog_zy_cha_nan_td_skill02_canying.pfx
   pfx\cha\kog_zy_cha_nan_td_skill02_canying_b6_pj01.pfx
   pfx\cha\kog_zy_lian_fangun_canying.pfx
   pfx\cha\pfx_cha_dd_lp01_skill01_canying.pfx
   pfx\cha\pfx_cha_nan_dd_fangun_b.pfx
   pfx\cha\pfx_cha_nan_dd_fangun_f.pfx
   pfx\cha\pfx_cha_nan_dd_fangun_l.pfx
   pfx\cha\pfx_cha_nan_dd_fangun_r.pfx
   pfx\cha\pfx_cha_nan_kw_fangun.pfx
   pfx\cha\pfx_cha_nan_kw_fangun_b.pfx
   pfx\cha\pfx_cha_nan_kw_fangun_l.pfx
   pfx\cha\pfx_cha_nan_kw_fangun_r.pfx
   pfx\cha\pfx_cha_nan_td_fangun_b.pfx
   pfx\cha\pfx_cha_nan_td_fangun_f.pfx
   pfx\cha\pfx_cha_nan_td_fangun_l.pfx
   pfx\cha\pfx_cha_nan_td_fangun_r.pfx
   pfx\chacj\kog_zlq_cha_taidao_zhanshi_02.pfx
   pfx\cha_low\low_pfx_cha_dd_lp01_skill01_canying.pfx
   pfx\cha_low\low_pfx_cha_nan_dd_fangun_b.pfx
   pfx\cha_low\low_pfx_cha_nan_dd_fangun_f.pfx
   pfx\cha_low\low_pfx_cha_nan_dd_fangun_l.pfx
   pfx\cha_low\low_pfx_cha_nan_dd_fangun_r.pfx
   pfx\mon\kog_zlq_npc_sly_xiaoshi_02.pfx
   pfx\mon_low\low_pfx_npc_leidiesi_001_skill03.pfx
   -- 模型发射器没有设置模型
   pfx\mov\kog_zlq_mofang_mov_chufa_01.pfx
   pfx\other\kog_zlq_wz_fangun_01.pfx
   ```

   

**对需求**

1. 如果特效 模型发射器前面的√没打上，要计入单个模型最大P的统计吗
2. 特效的详细信息中添加单个模型最大P后，是否要保留总的模型最大的P



部署到测试环境，并进行了测试

修改进度信息为中文，到测试环境

# 1224

安装新的fancy-dev.exe

验证必现的资源

## 单个模型P值

- 是否要部署到正式环境

  检查项有测试不通过的资源（阻断打包）

  正式环境res文件夹调整（打包过程的检查特效、单独的特效检查）

- 周五部署

## 动画检查

- 检查显示格式
- 检查的传输数据格式



- 查看有多少个san文件



1. 使用检查动画的代码
2. 做进度信息发送
3. 看拿关键帧的方法
4. 处理引擎问题（提交？patch出引擎）
5. 写job



# 1225

1. 主干资源测试问题
2. 处理引擎问题（提交？patch出引擎）
3. 写动画检查job



动画检查待办

- 动画检查帧的数字（向上取整超过39即取40）
- 动画检查



-tool



0. 16上加检查动画的引擎（不带验证，带动画检查patch）
1. 添加base-job
2. 添加三个环境对应的job
3. 测试 链接启动job



**动画检查**

1. 运行检查任务的地址

   //job地址

2. PROJECT_SVN http://10.1.1.13/fancy-dev-11/packagetool-test-forwp

3. WPID

4. POSTURL

**特效检查**

开发环境和测试环境

1、PFXRES_SVN修改为PROJECT_SVN
2、PROJECT_SVN到http://10.1.1.13/fancy-dev-11/packagetool-test-forwp



待办

- 正式环境修改PFXRES_SVN
- 检查动画的正式环境配置
- 资源检查的问题



自动化检查资源卡住问题：

**现象**



# 1226

## WP

把动画检查放到正式环境

1. 创建正式分支（暂时使用主干）
2. 正式job验证（使用测试资源）
3. 修改运行机器（暂时131）

特效检查 和WP同步修改资源地址信息（修改key和拼接client/res）

1. 等WP同步信息

## 内部

验证job并行触发

@蛋猫 提交引擎后，替换16上的动画检查引擎

## 资源检查

加资源检查崩溃报告

加监控进程



## 模型检查

1. 模型数据获取

   单个模型数据获取

   { filename, D, P }

2. 配置

3. 解析配置

4. 分析数据

5. 拼接lua表



配置

```lua
rule = {
    {
        showname = "主角",
        filter = "cha\\",
        rule = {
            {
                showname = "主角（自己）",
                filter = "cha_self\\",
                rule = {
                    {
                        showname = "高精度",
                        filter = "cha_self_high\\",
                        rule = {
                            {filter = 'cha_self_[w+]_face_[0-9]+', showname = "主角脸型", D = 1000, P = 1},
                            {filter = '_hair_', showname = "主角头发", D = 1000, P = 2},
                            {filter = '', showname = "主角装备", D = 6500, P = 2},
                        },
                    },
                },
            },
            {
                showname = "",
        		......
            }
        }
    },
    {
        showname = "",
        ......
    }
}

资源信息
rb:isMesh
msh、skn

rule为数组
递归搜，直到当前表没有rule属性，则为实际检查项

filter为各层级filter拼接
	优先级为当前检查项在整个filter中出现的顺序
	只要在前面的filter中出现

没筛选到的内容单独放表里（筛选不通过）
```

分析配置

```lua

local checkCurMesh(meshs, rule, headfilter)
	-- 每次执行清除已经测试过的信息
	-- (此处 删除的为索引表)
	-- 筛选并删除原数据
	local checks = {D, P}
	for i, v in ipairs(checks) do
    end
end

local funtion getMeshCheckResult(rule, headfilter)
	headfilter = headfilter or ''
	for i, r in ipairs(rule) do
        if r.rule then
    		getMeshCheckResult(r.rule, headfilter .. r.filter)
    	else
            indexs = checkMesh(meshs, r.rule, headfilter)
        end
    end
end

local function main(path, rule)
	-- getData
	-- index array/to remove
	-- getMeshCheckResult(meshdata, rule)
	-- format send table
	-- （detail/message）
	-- sendMessage
end
```



# 1227

## 模型检查

问题：

1. 只检查主角的？
2. 对于不和命名规范的，给出格式



# 1228

每次分析信息后，删除当前被筛选内容

将格式转换为WP需要的



detail面数实际



detail表

1. 所有模型的信息
2. 只保留检查项不合格的/命名不合格的
3. 命名不合格的信息怎么给

检查

1. 文件名匹配问题
2. 检查哪些文件夹
3. 采集物 D=0，P为空



文件夹内有其他文件时，我们在WP评估最下面加一块「路径不规范」的明细展示

没有被规则匹配到的文件，放到哪一层，名字怎么



中午：

问手机话费

制作手账模板

制作模板测试

读书笔记计划（2020 - 52本，每周一本）（模板）