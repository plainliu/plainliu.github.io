---
title: 20191125记录
date: 2019-11-25 10:50:02
tags:
- 记录
---



# 1125

## 打包工具

1. WP

   - ios/android
   - 整包/分包
   - svn + revision
   - 64、32

2. job

   -input

   - 来自WP

   -output

   - 项目名称

   - ios/android
   - 整包/分包
   - 打到哪一步
   - 项目分支本地位置
   - 64/32
   - foa版本

3. command sample & kog.lua

   -功能

   - 分析目录结构
   - 获得分组信息
   - 指定规则
   - 生成下一步的参数
   - 调用pt功能
   - 生成上传结果

   -input

   `start fancy-dev.exe -d "codefile|_command.lua|runcommand|package_service.lua|projectmode|Android|projectpath|E:\svn\kogsvn|procedure|apk|svnversion|36767|bytecodetype|32bit"`

   - 来自job

   -output
   
   - 



**问题记录：**

1. foa版本由哪里指定



检查pfxPD，131行报错

# 1126

- [ ] 自动化检查近几天的结果
- [x] 软著增加图片和内容
- [x] 新烘焙行数
- [x] 检查特效去掉地表特效的检查
- [x] 打包工具创建新的打包job



## 打包工具

入口

job

## 自动化结果汇总

**#15579 【F3D】【自动化】2019.11.14问题汇总**

- filter的问题（待确认）

- 后处理参数的问题（待确认）



**11.15**

- 大量不同、未提WT（待确认）



#15596 【F3D】【自动化】2019.11.19问题汇总

- 外发光问题（待确认）
- 逻辑地表（正常修改）



**11.20** 

- 修复外发光问题（？）
- 15098-FairyUI扩展功能编辑器 onCreateViewEvent添加接口（？）
- WT\15460-导出ui创建时的回调函数（新的有效果，老引擎黑屏）onCreateViewEvent（？）



**11.24**

- 14914-导出GRoot给lua\sample.lua（问题修复？/加新功能？）



**#15620 【F3D】【自动化】20191125问题汇总**

重新对比没有问题，关闭

是引擎没问题，测试工具的问题？还是已经修改了引擎改好了问题？



**分支**

**11.20**

**#15603 【F3D】【自动化】2019.11.20问题汇总**

不稳定例子？

- 14094-列表刷新功能\virtuallist

- 14616-文字框滚动及显示内容问题\code

- 15429-后处理雾在删除场景后有残留\code



11.21

不稳定

- Sample: debug-renderFilter



**#15614 【F3D】【自动化】2019.11.23问题汇总**

不稳定例子？

Sample: debug-renderFilter
Sample: texcoord-offset
Sample: fui-d
WT: 14616-文字框滚动及显示内容问题
WT: 15429-后处理雾在删除场景后有残留



11.24

不稳定？两个例子 C++ exception



11.25

不稳定

Sample: debug-renderFilter
WT: 14854-文字外发光效果实现
WT: 15429-后处理雾在删除场景后有残留



**不稳定例子**

## 软著

统计行数：写了小例子，1253

扩充介绍

# 1127

- [ ] 补充昨天的自动化结果汇总/删除16上多余的结果



问题记录：

主干：

1124

1120

- 15098

1115

- 几乎所有

1114

http://fancy3d.wt.fancyguo.com/task/show/15579



分支：

1124

- 13813 C++报错不一样多

- 13032-改例子

1123 

- fui-d 新的有报错
- texcoord-offset 新的有C++异常





**每日自动化测试结果处理：**

1. 验证当天的不同内容

   - 引擎bug导致的问题

     提汇总WT，和对应程序确认

   - 效果优化导致的大量不一致

     提汇总WT，和对应程序确认

   - 修复的问题对应的例子

     不用提WT，在出问题当日WT下留印记，如果全部解决，关闭WT

   - 工具问题（不稳定例子）

     可不提WT，告诉木可加忽略/提WT给木可

2. 提当日汇总WT

   汇总WT命名示例：【F3D】【自动化】2019.11.14问题汇总

   - 验证后需要提WT则提汇总WT，如果当日出现问题不止一个，提单独的WT，并和汇总关联

   - 主干和分支，当日汇总为一个WT，内容中说明测试引擎及结果的地址

3. 关闭WT

   - 当天测试结果确认是正常修改，且不稳定例子加忽略后，关闭WT

   - 关联WT全部解决后，关闭WT



# 1128

## 自动化

- 将上传功能放到模块里

  提供加后缀的模式

- 将错误报告崩溃报告，与截图分开上传

- 修改job，增加后缀传参、删除上传

- 添加不稳定例子

- 自动测试流程中加一个自动判断不稳定例子的过程，对于测试的结果中出现不一样的，再跑1次，如果这次一样，则为不稳定的，如果还是不一样，那么大概率是有问题的例子



## D值检查问题

| D值检查问题                   | 检查工具                                            | 编辑器                              | 例子               |
| ----------------------------- | --------------------------------------------------- | ----------------------------------- | ------------------ |
| 合并情况不一样                |                                                     | decal特效未合并，D值大              | decal              |
| 、、                          |                                                     | 其他特效存在未合并，D值大           | combine            |
| 自定义地表溶解特效            | 使用frameD统计没问题                                | 未统计（selected未统计到）          | dissolve           |
| decalD没统计到pfx/selectedD中 | 使用ParticleD统计没有decal                          | 编辑器中selected拿到了D（原因未知） |                    |
| 编辑器统计到的D不稳定         |                                                     | 例子中出现了11，13，15不稳定的情况  |                    |
| 普通地表特效部分没统计到      |                                                     |                                     | decal（不稳定）2/4 |
| 部分特效D值不一样             | 检查工具D少（扭曲特效没播放出来，FilterEffect关闭） |                                     | twist              |
| frameD中selected统计两次      |                                                     |                                     |                    |
|                               | 10                                                  | 15                                  |                    |



| D值检查问题 | 检查工具 | 编辑器   |
| ----------- | -------- | -------- |
| all         | 10/8     | 11/13/15 |
| decal       | 2        | 4/2      |
| combine     | 2        | 1        |
| combine2    | 2        | 4        |
| dissolve    | 1        | 1        |
| twist       | 0        | 1        |



## 检查特效工具

- 对特效的生命周期做统计
- 阶梯标准检查



### 阶梯检查

检查单个Pfx，使用子进程得到相关数据

**收集数据**

将数据保存成文件，可以从缓存的文件中再次分析

**分析阶段**

得到插值表，0 = x1 = 1

```lua
counts = {
    0 = x,
    1 = y,
    2 = z,
    5 = r,
    10 = u,
    ...
}
```

根据**配置**将以上内容插入对应区间

```lua
for k, count in pairs(counts) do
    allcount += count
    if 区间1 then
        区间1 += count
    elseif 区间2 then
        区间2 += count
    elseif ... then
        ...
    end
end
```

配置表-使用

```lua
-- 运行跑出结果
checkPfx()

-- 分析结果
config = {
    checkD = {
        {min = 0, max = 4, ratio = 80},
        {min = 5, max = 6},
        {min = 1, max = 2},
    }
}

report(config)
```



# 1129

## 检查特效PD工具

- 阶梯标准
- 输出到表格

### 需求

检查的特效

1. 每个特效需要的信息

   D、P、img尺寸、发射器个数

2. 检查

   **a. 检查标准**

   对于特效的**每个**检查值

   eg: 分范围给定比例，比如D

   - 0-4: 90%
   - 5-8: 5%
   - ...

   **b. 结果**

   - 总的统计
   - 分文件夹的统计

   **c. 根据命名对应不一样的标准？**

   - ui_a_xxx 低级（0-4）
   - ui_b_xxx 中级（5-8）

3. 填表格

   分sheet填表格

   不合格的标红（不合格的标准需要再确认）



### 方案

> 放到commands中，提供一个和打包kog.lua类似的配置文件
>
> 用py生成表格，py提交在模块中，作为资源



流程

1. 获取单个特效的信息

   使用子进程获取、生成中间文件

   主进程读取中间文件、返回当前特效的信息

2. 收集所有特效的信息

   获取所有信息

3. 分析

   归类

4. 生成表格



**子进程**

重新写一个，部分重复的函数从旧的checkpfx中拿

```lua
function getPfxMaxLifeTime()
    -- emitters delay/duration/intervel/maxlifetime ...
end
function getImageInfo()
end
function getEmitterInfo()
end
function writeInfo()
    -- gen tmp.lua
end
function render()
    maxD
    maxP

    -- lifetime = getPfxMaxLifeTime()
    if time > lifetime then
    	getImageInfo()
    	getEmitterInfo()
        writeInfo()
    end
end
```



**主进程**

拿到所有特效信息并生成中间文件，交给py做处理（分all的和文件夹的结果）

把配置标准也生成为中间文件

```lua
function getParticleInfo(pfx)
    callSlave(pfx)
    
    return _dofile('tmp.lua')
end

function runall()
    if mesh or decal return end
    
    local all = {}
    for pfx:pfxs do
        info = getParticleInfo(pfx)
        table.insert(all, info)
    end
    
    return all
end

function writeData(tb)
    -- write to txt
end

function writeStanderd(config)
    -- write to txt
end

function writeResult(config)
    all = runall()
    
    writeStanderd(config)
    -- report
    writeData(all)
    writeData(folders-result)
end
```



**py**

```python
def getStanderds():
    # read txt
    
def writeData(rpt):
    # write to sheet
    # read rpt
    # write to xl sheet
    # sort
    
def writeOneAnalyseFunc():
    # count date and write func
    # compare and mark Red

def writeAllFunc:
    for std in standerds:
    	writeOneAnalyseFunc()

def main():
    getStanderds()
    for rpt in reports:
    	writeDate(rpt)
    	writeAllFunc()
```



保存信息时加上路径

配置里做filter筛选



## 打包特效问题



## 其他

打包特效问题

docommand没删掉bat文件



# 1130

kog群的问题，修改文件名后编码格式也变了？

返回特效信息时，加上特效名称



检查特效：

用lua生成总的结果，之后的区分和匹配子文件夹全交给python

有新需求则修改python



## python学习笔记

```
以下划线开头的标识符是有特殊意义的。以单下划线开头 _foo 的代表不能直接访问的类属性，需通过类提供的接口进行访问，不能用 from xxx import * 而导入。

以双下划线开头的 __foo 代表类的私有成员，以双下划线开头和结尾的 __foo__ 代表 Python 里特殊方法专用的标识，如 __init__() 代表类的构造函数。

Python 可以同一行显示多条语句，方法是用分号 ; 分开

Python 的代码块不使用大括号 {} 来控制类，函数以及其他逻辑判断。python 最具特色的就是用缩进来写模块。

Python语句中一般以新行作为语句的结束符。
但是我们可以使用斜杠（ \）将一行的语句分为多行显示。
语句中包含 [], {} 或 () 括号就不需要使用多行连接符。

Python 可以使用引号( ' )、双引号( " )、三引号( ''' 或 """ ) 来表示字符串，其中三引号可以由多行组成

python中单行注释采用 # 开头。
python 中多行注释使用三个单引号(''')或三个双引号(""")。【和多行字符串一样】

Python 中的变量赋值不需要类型声明。
每个变量在内存中创建，都包括变量的标识，名称和数据这些信息。
每个变量在使用前都必须赋值，变量赋值以后该变量才会被创建。

数字数据类型用于存储数值。
他们是不可改变的数据类型，这意味着改变数字数据类型会分配一个新的对象。
您也可以使用del语句删除一些对象的引用。

Python支持四种不同的数字类型：
    int（有符号整型）【1/-10】
    long（长整型[也可以代表八进制和十六进制]）【512L/-0x1DL/0122L】【为小写l与1区分，建议大写】
    float（浮点型）【0.0】
    complex（复数） 【3.14j/.876j/3e+26J】【可以用 a + bj,或者 complex(a,b) 表示， 复数的实部 a 和虚部 b 都是浮点型】
    注意：long 类型只存在于 Python2.X 版本中，在 2.2 以后的版本中，int 类型数据溢出后会自动转为long类型。在 Python3.X 版本中 long 类型被移除，使用 int 替代。

python的字串列表有2种取值顺序:
    从左到右索引默认0开始的，最大范围是字符串长度少1
    从右到左索引默认-1开始的，最大范围是字符串开头
    取的子字符串包含头下标的字符，但不包含尾下标的字符【截取字符串：s[1:5]】

加号（+）是字符串连接运算符，星号（*）是重复操作
print str * 2       # 输出字符串两次
str[1:4:2]			# 第三个参数表示步长

List（列表） 是 Python 中使用最频繁的数据类型。
可以完成大多数集合类的数据结构实现。它支持字符，数字，字符串甚至可以包含列表（即嵌套）
列表用 [ ] 标识
也支持和字符串一样的切割操作和拼接操作

元组是另一个数据类型，类似于 List（列表）
元组不能二次赋值，相当于只读列表。
元组用 () 标识
同样支持切割和+拼接

Python 字典
字典用"{ }"标识。字典由索引(key)和它对应的值value组成。
tinydict = {'name': 'john','code':6734, 'dept': 'sales'}

在接收raw_input方法后，判断接收到的字符串是否为数字
例如：
str = raw_input("please input the number:")
if str.isdigit():

为True表示输入的所有字符都是数字，否则，不是全部为数字

str为字符串
str.isalnum() 所有字符都是数字或者字母
str.isalpha() 所有字符都是字母
str.isdigit() 所有字符都是数字
str.islower() 所有字符都是小写
str.isupper() 所有字符都是大写
str.istitle() 所有单词都是首字母大写，像标题
str.isspace() 所有字符都是空白字符、\t、\n、\r
```



使用表格

版本2.7

xlrd

直接输入命令"pip install xlrd"【和"pip install xlwt"】

![1575098944140](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\1575098944140.png)



pip install XlsxWriter

![1575099237098](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\1575099237098.png)

写表格好用，但是不能读取



pip install xlutils

![1575109150697](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\1575109150697.png)











备注：

https://steamcommunity.com/linkfilter/?url=https://factorio.com/store

异星工厂文化衫